<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pong â€” Aaron Wojtaszek</title>
    <meta name="description" content="Play a game of Pong!" />
    <meta name="author" content="Aaron Wojtaszek" />
    <meta name="referrer" content="no-referrer" />
    <link rel="stylesheet" href="assets/css/main.css" />

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-52634255-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-52634255-2');
    </script>
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .game-canvas {
            border: 2px solid #1a1a1a;
            border-radius: 4px;
            background-color: #1a1a1a;
            max-width: 100%;
            touch-action: none;
        }
        .game-score {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a1a;
        }
        .game-score span {
            color: #4a6fa5;
        }
        .game-instructions {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #777;
            text-align: center;
            line-height: 1.6;
        }
        .game-btn {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.6rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: #fff;
            background-color: #4a6fa5;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-family: inherit;
        }
        .game-btn:hover {
            background-color: #2d4a7a;
        }

        /* Leaderboard */
        .leaderboard {
            margin-top: 2rem;
            width: 100%;
            max-width: 400px;
        }
        .leaderboard h2 {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
            text-align: center;
        }
        .leaderboard table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .leaderboard th {
            text-align: left;
            padding: 0.5rem 0.75rem;
            border-bottom: 2px solid #e8e8e4;
            color: #777;
            font-weight: 500;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }
        .leaderboard th:last-child {
            text-align: right;
        }
        .leaderboard td {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid #f0f0ec;
            color: #2d2d2d;
        }
        .leaderboard td:first-child {
            color: #4a6fa5;
            font-weight: 600;
        }
        .leaderboard td:last-child {
            text-align: right;
            font-weight: 500;
        }
        .leaderboard-empty {
            text-align: center;
            color: #999;
            font-size: 0.85rem;
            padding: 1rem 0;
        }

        /* Win modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: #fff;
            border-radius: 12px;
            padding: 2rem;
            max-width: 340px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        .modal h3 {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.4rem;
            color: #1a1a1a;
            margin-bottom: 0.5rem;
        }
        .modal p {
            color: #555;
            font-size: 0.95rem;
            margin-bottom: 1.25rem;
        }
        .modal input {
            width: 100px;
            padding: 0.5rem 0.75rem;
            font-size: 1.2rem;
            font-family: inherit;
            text-align: center;
            text-transform: uppercase;
            border: 2px solid #d0d0cc;
            border-radius: 6px;
            outline: none;
            letter-spacing: 0.15em;
            transition: border-color 0.2s ease;
        }
        .modal input:focus {
            border-color: #4a6fa5;
        }
        .modal-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1.25rem;
        }
        .modal-btn-primary {
            padding: 0.5rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: #fff;
            background-color: #4a6fa5;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            transition: background-color 0.2s ease;
        }
        .modal-btn-primary:hover {
            background-color: #2d4a7a;
        }
        .modal-btn-secondary {
            padding: 0.5rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
            background: none;
            border: 1px solid #d0d0cc;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
        }
        .modal-btn-secondary:hover {
            border-color: #999;
            color: #1a1a1a;
        }
    </style>
</head>
<body>

    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-name"><a href="index.html">Aaron Wojtaszek</a></div>
        <button class="menu-toggle" aria-label="Toggle navigation">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
    <div class="mobile-overlay"></div>

    <div class="site-wrapper">

        <!-- Sidebar -->
        <aside class="sidebar">
            <div>
                <div class="sidebar-header">
                    <div class="sidebar-name"><a href="index.html">Aaron Wojtaszek</a></div>
                    <p class="sidebar-tagline">Senior Product Manager</p>
                </div>

                <nav class="sidebar-nav">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="minigame.html" class="active">Pong</a></li>
                    </ul>
                </nav>
            </div>

            <div class="sidebar-social">
                <a href="https://www.linkedin.com/in/aaronwojtaszek/" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://github.com/aaronwojtaszek" aria-label="GitHub"><i class="fab fa-github"></i></a>
                <a href="mailto:aaronwojtaszek@gmail.com" aria-label="Email"><i class="fas fa-envelope"></i></a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-content">

                <div class="section">
                    <h1 class="section-title">Pong</h1>

                    <div class="game-container">
                        <div class="game-score">
                            <div>You: <span id="playerScore">0</span></div>
                            <div>CPU: <span id="cpuScore">0</span></div>
                        </div>
                        <canvas id="pongCanvas" class="game-canvas" width="600" height="400"></canvas>
                        <button class="game-btn" id="startBtn">Start Game</button>
                        <div class="game-instructions">
                            First to 3 wins!<br>
                            <strong>Desktop:</strong> Mouse or arrow keys &nbsp;|&nbsp; <strong>Mobile:</strong> Touch &amp; drag
                        </div>

                        <!-- Leaderboard -->
                        <div class="leaderboard">
                            <h2>Leaderboard</h2>
                            <table>
                                <thead>
                                    <tr><th>#</th><th>Initials</th><th>Score</th></tr>
                                </thead>
                                <tbody id="leaderboardBody">
                                </tbody>
                            </table>
                            <div class="leaderboard-empty" id="leaderboardEmpty">No scores yet. Be the first!</div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="site-footer">
                    &copy; Aaron Wojtaszek. All rights reserved.
                </footer>

            </div>
        </main>

    </div>

    <!-- Win Modal -->
    <div class="modal-overlay" id="winModal">
        <div class="modal">
            <h3 id="modalTitle">You Win!</h3>
            <p id="modalMsg">Final score: 5 - 0</p>
            <label for="initialsInput" style="display:none;">Enter your initials:</label>
            <input type="text" id="initialsInput" maxlength="3" placeholder="AAA" />
            <div class="modal-actions">
                <button class="modal-btn-primary" id="modalSave">Save Score</button>
                <button class="modal-btn-secondary" id="modalSkip">Skip</button>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        var menuToggle = document.querySelector('.menu-toggle');
        var sidebar = document.querySelector('.sidebar');
        var overlay = document.querySelector('.mobile-overlay');

        function openMenu() {
            sidebar.classList.add('open');
            overlay.classList.add('active');
            menuToggle.classList.add('active');
            document.documentElement.classList.add('menu-open');
        }

        function closeMenu() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
            menuToggle.classList.remove('active');
            document.documentElement.classList.remove('menu-open');
        }

        menuToggle.addEventListener('click', function() {
            if (sidebar.classList.contains('open')) {
                closeMenu();
            } else {
                openMenu();
            }
        });

        overlay.addEventListener('click', closeMenu);

        document.querySelectorAll('.sidebar-nav a').forEach(function(link) {
            link.addEventListener('click', closeMenu);
        });
    </script>

    <script>
        var canvas = document.getElementById('pongCanvas');
        var ctx = canvas.getContext('2d');
        var startBtn = document.getElementById('startBtn');
        var playerScoreEl = document.getElementById('playerScore');
        var cpuScoreEl = document.getElementById('cpuScore');
        var winModal = document.getElementById('winModal');
        var modalTitle = document.getElementById('modalTitle');
        var modalMsg = document.getElementById('modalMsg');
        var initialsInput = document.getElementById('initialsInput');
        var modalSave = document.getElementById('modalSave');
        var modalSkip = document.getElementById('modalSkip');
        var leaderboardBody = document.getElementById('leaderboardBody');
        var leaderboardEmpty = document.getElementById('leaderboardEmpty');

        var WIN_SCORE = 3;

        // ---- Sound Effects (Web Audio API) ----
        var audioCtx = null;
        function getAudioCtx() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioCtx;
        }
        function playTone(freq, duration, type, vol) {
            try {
                var ctx = getAudioCtx();
                var osc = ctx.createOscillator();
                var gain = ctx.createGain();
                osc.type = type || 'square';
                osc.frequency.value = freq;
                gain.gain.value = vol || 0.12;
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + duration);
            } catch(e) {}
        }
        function sndPaddle()  { playTone(440, 0.08, 'square', 0.12); }
        function sndWall()    { playTone(300, 0.06, 'sine', 0.08); }
        function sndScoreFor()  { playTone(660, 0.15, 'square', 0.1); }
        function sndScoreAgainst() { playTone(180, 0.25, 'sawtooth', 0.1); }
        function sndWin() {
            playTone(523, 0.12, 'square', 0.12);
            setTimeout(function(){ playTone(659, 0.12, 'square', 0.12); }, 120);
            setTimeout(function(){ playTone(784, 0.25, 'square', 0.14); }, 240);
        }
        function sndLose() {
            playTone(400, 0.15, 'sawtooth', 0.1);
            setTimeout(function(){ playTone(300, 0.15, 'sawtooth', 0.1); }, 150);
            setTimeout(function(){ playTone(200, 0.3, 'sawtooth', 0.12); }, 300);
        }

        // Responsive canvas sizing
        function resizeCanvas() {
            var container = canvas.parentElement;
            var maxW = container.clientWidth;
            if (maxW < 600) {
                canvas.width = maxW;
                canvas.height = Math.round(maxW * (2/3));
            } else {
                canvas.width = 600;
                canvas.height = 400;
            }
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        var paddleW = 10, paddleH, ballSize = 8;
        var playerY, cpuY, ballX, ballY, ballDX, ballDY;
        var playerScore = 0, cpuScore = 0;
        var gameRunning = false;
        var animFrame;
        var cpuSpeed;

        function initGame() {
            paddleH = canvas.height * 0.18;
            playerY = (canvas.height - paddleH) / 2;
            cpuY = (canvas.height - paddleH) / 2;
            ballX = canvas.width / 2;
            ballY = canvas.height / 2;
            var speed = canvas.width * 0.01;
            ballDX = speed * (Math.random() > 0.5 ? 1 : -1);
            ballDY = speed * (Math.random() > 0.5 ? 1 : -1);
            cpuSpeed = speed * 0.42;
        }

        function drawRect(x, y, w, h, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, w, h);
        }

        function drawBall(x, y, r, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawNet() {
            ctx.setLineDash([6, 6]);
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function draw() {
            drawRect(0, 0, canvas.width, canvas.height, '#1a1a1a');
            drawNet();
            drawRect(15, playerY, paddleW, paddleH, '#4a6fa5');
            drawRect(canvas.width - 15 - paddleW, cpuY, paddleW, paddleH, '#e8e8e4');
            drawBall(ballX, ballY, ballSize, '#fff');
        }

        function update() {
            ballX += ballDX;
            ballY += ballDY;

            if (ballY - ballSize < 0 || ballY + ballSize > canvas.height) {
                ballDY = -ballDY;
                sndWall();
            }

            if (ballX - ballSize < 15 + paddleW && ballY > playerY && ballY < playerY + paddleH && ballDX < 0) {
                ballDX = -ballDX * 1.05;
                var hitPos = (ballY - playerY) / paddleH - 0.5;
                ballDY = hitPos * canvas.width * 0.01;
                sndPaddle();
            }

            if (ballX + ballSize > canvas.width - 15 - paddleW && ballY > cpuY && ballY < cpuY + paddleH && ballDX > 0) {
                ballDX = -ballDX * 1.05;
                var hitPos = (ballY - cpuY) / paddleH - 0.5;
                ballDY = hitPos * canvas.width * 0.01;
                sndPaddle();
            }

            // CPU only reacts when ball is heading toward it
            var cpuCenter = cpuY + paddleH / 2;
            if (ballDX > 0) {
                var deadZone = paddleH * 0.35;
                if (cpuCenter < ballY - deadZone) {
                    cpuY += cpuSpeed;
                } else if (cpuCenter > ballY + deadZone) {
                    cpuY -= cpuSpeed;
                }
            } else {
                // Drift slowly toward center when ball is going away
                var center = canvas.height / 2;
                if (cpuCenter < center - 5) {
                    cpuY += cpuSpeed * 0.3;
                } else if (cpuCenter > center + 5) {
                    cpuY -= cpuSpeed * 0.3;
                }
            }
            cpuY = Math.max(0, Math.min(canvas.height - paddleH, cpuY));

            // Scoring
            if (ballX - ballSize < 0) {
                cpuScore++;
                cpuScoreEl.textContent = cpuScore;
                if (cpuScore >= WIN_SCORE) {
                    sndLose();
                    endGame(false);
                    return;
                }
                sndScoreAgainst();
                resetBall();
            }
            if (ballX + ballSize > canvas.width) {
                playerScore++;
                playerScoreEl.textContent = playerScore;
                if (playerScore >= WIN_SCORE) {
                    sndWin();
                    endGame(true);
                    return;
                }
                sndScoreFor();
                resetBall();
            }

            var maxSpeed = canvas.width * 0.024;
            if (Math.abs(ballDX) > maxSpeed) ballDX = maxSpeed * Math.sign(ballDX);
            if (Math.abs(ballDY) > maxSpeed) ballDY = maxSpeed * Math.sign(ballDY);
        }

        function resetBall() {
            ballX = canvas.width / 2;
            ballY = canvas.height / 2;
            var speed = canvas.width * 0.01;
            ballDX = speed * (Math.random() > 0.5 ? 1 : -1);
            ballDY = speed * (Math.random() > 0.5 ? 1 : -1);
        }

        function endGame(playerWon) {
            gameRunning = false;
            cancelAnimationFrame(animFrame);
            startBtn.textContent = 'Play Again';

            if (playerWon) {
                modalTitle.textContent = 'You Win!';
                modalMsg.textContent = 'Final score: ' + playerScore + ' - ' + cpuScore;
                initialsInput.value = '';
                initialsInput.style.display = '';
                initialsInput.parentElement.querySelector('label').style.display = '';
                modalSave.style.display = '';
                winModal.classList.add('active');
                setTimeout(function() { initialsInput.focus(); }, 100);
            } else {
                modalTitle.textContent = 'CPU Wins';
                modalMsg.textContent = 'Final score: ' + playerScore + ' - ' + cpuScore;
                initialsInput.style.display = 'none';
                initialsInput.parentElement.querySelector('label').style.display = 'none';
                modalSave.style.display = 'none';
                winModal.classList.add('active');
            }
        }

        function gameLoop() {
            if (!gameRunning) return;
            update();
            draw();
            animFrame = requestAnimationFrame(gameLoop);
        }

        // Mouse control
        canvas.addEventListener('mousemove', function(e) {
            var rect = canvas.getBoundingClientRect();
            var scaleY = canvas.height / rect.height;
            playerY = (e.clientY - rect.top) * scaleY - paddleH / 2;
            playerY = Math.max(0, Math.min(canvas.height - paddleH, playerY));
        });

        // Touch control
        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            var rect = canvas.getBoundingClientRect();
            var scaleY = canvas.height / rect.height;
            var touch = e.touches[0];
            playerY = (touch.clientY - rect.top) * scaleY - paddleH / 2;
            playerY = Math.max(0, Math.min(canvas.height - paddleH, playerY));
        }, { passive: false });

        // Keyboard control
        var keysDown = {};
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                e.preventDefault();
                keysDown[e.key] = true;
            }
        });
        document.addEventListener('keyup', function(e) {
            keysDown[e.key] = false;
        });

        setInterval(function() {
            if (!gameRunning) return;
            var speed = canvas.height * 0.015;
            if (keysDown['ArrowUp']) {
                playerY = Math.max(0, playerY - speed);
            }
            if (keysDown['ArrowDown']) {
                playerY = Math.min(canvas.height - paddleH, playerY + speed);
            }
        }, 16);

        // Start / Reset
        startBtn.addEventListener('click', function() {
            playerScore = 0;
            cpuScore = 0;
            playerScoreEl.textContent = '0';
            cpuScoreEl.textContent = '0';
            resizeCanvas();
            initGame();
            gameRunning = true;
            startBtn.textContent = 'Reset';
            gameLoop();
        });

        // ---- Leaderboard ----
        var STORAGE_KEY = 'pong_leaderboard';

        function getLeaderboard() {
            try {
                var data = JSON.parse(localStorage.getItem(STORAGE_KEY));
                return Array.isArray(data) ? data : [];
            } catch(e) {
                return [];
            }
        }

        function saveLeaderboard(board) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(board));
        }

        function addScore(initials, pScore, cScore) {
            var board = getLeaderboard();
            board.push({ initials: initials.toUpperCase(), playerScore: pScore, cpuScore: cScore });
            // Sort: highest player score first, then lowest cpu score
            board.sort(function(a, b) {
                if (b.playerScore !== a.playerScore) return b.playerScore - a.playerScore;
                return a.cpuScore - b.cpuScore;
            });
            // Keep top 10
            board = board.slice(0, 10);
            saveLeaderboard(board);
            renderLeaderboard();
        }

        function renderLeaderboard() {
            var board = getLeaderboard();
            leaderboardBody.innerHTML = '';
            if (board.length === 0) {
                leaderboardEmpty.style.display = '';
                return;
            }
            leaderboardEmpty.style.display = 'none';
            for (var i = 0; i < board.length; i++) {
                var row = document.createElement('tr');
                row.innerHTML = '<td>' + (i + 1) + '</td><td>' + escapeHtml(board[i].initials) + '</td><td>' + board[i].playerScore + ' - ' + board[i].cpuScore + '</td>';
                leaderboardBody.appendChild(row);
            }
        }

        function escapeHtml(str) {
            var div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // Modal handlers
        modalSave.addEventListener('click', function() {
            var initials = initialsInput.value.replace(/[^a-zA-Z0-9]/g, '').substring(0, 3);
            if (initials.length === 0) {
                initialsInput.focus();
                return;
            }
            addScore(initials, playerScore, cpuScore);
            winModal.classList.remove('active');
        });

        modalSkip.addEventListener('click', function() {
            winModal.classList.remove('active');
        });

        initialsInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                modalSave.click();
            }
        });

        // Init
        initGame();
        draw();
        renderLeaderboard();
    </script>

</body>
</html>
